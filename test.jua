fn fib_slow(n) = (n <= 2) ? 1 : fib_slow(n - 1) + fib_slow(n - 2);

fn fib_fast(n) {
    q1 = q2 = 1;
    for i = 2; i < n; i++ {
        qt = q1 + q2;
        q1 = q2;
        q2 = qt;
    }
    return q2;
}

fn sort(a) = quick_sort(a); // default sort

fn quick_sort(a, lo = null, hi = null) {
    i = lo ??= 0;
    j = hi ??= length(a) - 1;
    pivot = a[(i + j) >> 1];
    do {
        while (a[i] < pivot) i++;
        while (a[j] > pivot) j--;
        if (i <= j) {
            tmp = a[i];
            a[i] = a[j];
            a[j] = tmp;
            i++; j--;
        }
    } while (i <= j);
    if (j > lo) quick_sort(a, lo, j);
    if (i < hi) quick_sort(a, i, hi);
}

fn bubble_sort(a) {
    for i = 0; i < length(a); i++ {
        for j = 1; j < length(a) - i; j++ {
            x = a[j - 1];
            y = a[j];
            if x > y {
                a[j - 1] = y;
                a[j] = x;
            }
        }
    }
}

fn stringify_list(l) {
    s = "";
    for i = 0; i < length(l); i++ {
        if s { // check if s not empty
            s += ", ";
        }
        if array_index_of(['map', 'array'], typeof(l[i])) >= 0
            s += "<map>";
        else if l[i] == l
            s += "<self>";
        else
            s += stringify_list(l[i]);
    }
    return "[" + s + "]";
}

fn pascal_triangle(height) {
    cols = [];
    for i = 0; i <= height; i++ {
        cols[i] = [];
        cols[i][0] = cols[i][i] = 1;
        for j = 1; j < i; j++ {
            cols[i][j] = cols[i - 1][j - 1] + cols[i - 1][j];
        }
    }
    return cols;
}

fn range(from, to, step = 1) {
    range = [];
    for i = from; i <= to; i += step {
        array_push(range, i);
    }
    return range;
}

fn array_push(arr, elem) {
    arr[length(arr)] = elem;
}

fn array_pop(arr) {
    tmp = arr[key = length(arr) - 1];
    arr[key] = null;
    return tmp;
}

fn array_avg(arr) {
    cleaned_arr = array_unique(arr);
    if (len = length(cleaned_arr)) < 1
        return cleaned_arr[0] ?? 0.0;
    return array_sum(cleaned_arr) / len;
}

fn array_max(arr) {
    m = arr[0];
    for i = 1, l = length(arr); i < l; i++ {
        if (e = arr[i]) > m {
            m = e;
        }
    }
    return m;
}

fn array_min(arr) {
    m = arr[0];
    for i = 1, l = length(arr); i < l; i++ {
        if (e = arr[i]) < m {
            m = e;
        }
    }
    return m;
}

fn array_index_of(arr, elem, start = 0) {
    for l = length(arr), i = start; i < l; i++ {
        if arr[i] == elem {
            return i;
        }
    }
    return -1;
}

fn array_last_index_of(arr, elem, start = 0) {
    for l = length(arr), i = l - start - 1; i >= 0; i-- {
        if arr[i] == elem {
            return i;
        }
    }
    return -1;
}

fn array_unique(arr) {
    if length(arr) <= 1
        return arr;
    result = [];
    for i = 0, l = length(arr); i < l; i++ {
        if array_index_of(result, arr[i]) == -1 {
            array_push(result, arr[i]);
        }
    }
    return result;
}

fn array_sum(arr) {
    sum = 0;
    for i = 0, l = length(arr); i < l; i++ {
        sum += arr[i];
    }
    return sum;
}

fn join(pieces, separator) {
    s = "";
    if (len = length(pieces)) > 0 {
        s += pieces[0];

        for i = 1; i < len; i++ {
            s = s + separator + pieces[i];
        }
    }
    return s;
}

fn abs(n) = (n < 0) ? -n : n;

fn test_switch(x) {
    switch x {
        case 'rc': return 11286; case 'gk': return 11021;
        case 'ih': return 10920; case 'pf': return 11424;
        case 'mh': return 11336; case 'zp': return 13664;
        case 'sm': return 12535; case 'jk': return 11342;
        case 'pv': return 13216; case 'cp': return 11088;
        case 'hc': return 10296; case 'au': return 11349;
        case 'ru': return 13338; case 'og': return 11433;
        case 'sg': return 11845; case 'sw': return 13685;
        case 'ln': return 11880; case 'by': return 11858;
        case 'zm': return 13298; case 'yx': return 14520;
        case 'fm': return 11118; case 'un': return 12870;
        case 'pn': return 12320; case 'mb': return 10682;
        case 'nu': return 12870; case 'yv': return 14278;
        case 'ry': return 13794; case 'ls': return 12420;
        case 'hb': return 10192; case 'yl': return 13068;
        case 'er': return 11514; case 'lp': return 12096;
        case 'od': return 11100; case 'hh': return 10816;
        case 'ym': return 13189; case 'ow': return 13209;
        case 'cj': return 10494; case 'fj': return 10812;
        case 'uz': return 14274; case 'kv': return 12626;
        case 'xy': return 14520; case 'tt': return 13456;
        case 'jn': return 11660; case 'em': return 11009;
        case 'vo': return 13098; case 'wz': return 14518;
        case 'vu': return 13806; case 'qd': return 11300;
        case 'al': return 10476; case 'ct': return 11484;
        case 'lv': return 12744; case 'zs': return 14030;
        case 'wl': return 12852; case 'ta': return 11252;
        case 'db': return 9800; case 'ee': return 10201;
        case 'yo': return 13431; case 'le': return 10908;
        case 'be': return 9898; case 'sh': return 11960;
        case 'vv': return 13924; case 'ps': return 12880;
        case 'sk': return 12305; case 'zc': return 12078;
        case 'zv': return 14396; case 'vc': return 11682;
        case 'bm': return 10682; case 'or': return 12654;
        case 'hs': return 11960; case 'ge': return 10403;
        case 'iu': return 12285; case 'bl': return 10584;
        case 'sl': return 12420; case 'xi': return 12600;
        case 'gw': return 12257; case 'qc': return 11187;
        case 'jv': return 12508; case 'ml': return 11772;
        case 'fb': return 9996; case 'ql': return 12204;
        case 'ny': return 13310; case 'yi': return 12705;
        case 'eu': return 11817; case 'gb': return 10094;
        case 'jq': return 11978; case 'tc': return 11484;
        case 'yz': return 14762; case 'ku': return 12519;
        case 'dj': return 10600; case 'tl': return 12528;
        case 'eb': return 9898; case 'kr': return 12198;
        case 'yr': return 13794; case 'lw': return 12852;
        case 'vy': return 14278; case 'dx': return 12000;
        case 'eo': return 11211; case 'pb': return 10976;
        case 'aj': return 10282; case 'tb': return 11368;
        case 'uh': return 12168; case 'ip': return 11760;
        case 'ze': return 12322; case 'eh': return 10504;
        case 'ki': return 11235; case 'gj': return 10918;
        case 'tg': return 11948; case 'ew': return 12019;
        case 'af': return 9894; case 'na': return 10670;
        case 'li': return 11340; case 'zr': return 13908;
        case 'bd': return 9800; case 'ib': return 10290;
        case 'vm': return 12862; case 'at': return 11252;
        case 'xa': return 11640; case 'wa': return 11543;
        case 'hu': return 12168; case 'cm': return 10791;
        case 'bp': return 10976; case 'kb': return 10486;
        case 'nh': return 11440; case 'rh': return 11856;
        case 'kt': return 12412; case 'xd': return 12000;
        case 'fp': return 11424; case 'jf': return 10812;
        case 'km': return 11663; case 'es': return 11615;
        case 'eq': return 11413; case 'ju': return 12402;
        case 'ek': return 10807; case 'gv': return 12154;
        case 'kf': return 10914; case 'kh': return 11128;
        case 'rb': return 11172; case 'zz': return 14884;
        case 'rp': return 12768; case 'yt': return 14036;
        case 'dw': return 11900; case 'ur': return 13338;
        case 'ld': return 10800; case 'cd': return 9900;
        case 'ei': return 10605; case 'qq': return 12769;
        case 'tx': return 13920; case 'jc': return 10494;
        case 'uq': return 13221; case 'lc': return 10692;
        case 'ao': return 10767; case 'gm': return 11227;
        case 'nt': return 12760; case 'lh': return 11232;
        case 'ig': return 10815; case 'dd': return 10000;
        case 'gh': return 10712; case 'kl': return 11556;
        case 'vd': return 11800; case 'cl': return 10692;
        case 'an': return 10670; case 'mz': return 13298;
        case 'ha': return 10088; case 'ex': return 12120;
        case 'ak': return 10379; case 'hm': return 11336;
        case 'gs': return 11845; case 'kx': return 12840;
        case 'sa': return 11155; case 'ks': return 12305;
        case 'zk': return 13054; case 'ni': return 11550;
        case 'pz': return 13664; case 'vf': return 12036;
        case 'rd': return 11400; case 'hx': return 12480;
        case 'zj': return 12932; case 'pl': return 12096;
        case 'ri': return 11970; case 'cw': return 11781;
        case 'fz': return 12444; case 'rn': return 12540;
        case 'jx': return 12720; case 'no': return 12210;
        case 'kk': return 11449; case 'qj': return 11978;
        case 'wo': return 13209; case 'dv': return 11800;
        case 'yp': return 13552; case 'sz': return 14030;
        case 'jt': return 12296; case 'pa': return 10864;
        case 'dc': return 9900; case 'il': return 11340;
        case 'ho': return 11544; case 'me': return 11009;
        case 'ol': return 11988; case 'av': return 11446;
        case 'wr': return 13566; case 'sd': return 11500;
        case 'yq': return 13673; case 'zg': return 12566;
        case 'yy': return 14641; case 'qs': return 12995;
        case 'tr': return 13224; case 'cy': return 11979;
        case 'st': return 13340; case 'ji': return 11130;
        case 'mn': return 11990; case 'bk': return 10486;
        case 'wf': return 12138; case 'ce': return 9999;
        case 'iz': return 12810; case 'lf': return 11016;
        case 'iy': return 12705; case 'jm': return 11554;
        case 'zu': return 14274; case 'kj': return 11342;
        case 'dr': return 11400; case 'ep': return 11312;
        case 'ob': return 10878; case 'nf': return 11220;
        case 'fx': return 12240; case 'se': return 11615;
        case 'jy': return 12826; case 'lk': return 11556;
        case 'uv': return 13806; case 'cg': return 10197;
        case 'fa': return 9894; case 'wu': return 13923;
        case 'jd': return 10600; case 'zt': return 14152;
        case 'cq': return 11187; case 'xe': return 12120;
        case 'px': return 13440; case 'ye': return 12221;
        case 'xj': return 12720; case 'fr': return 11628;
        case 'lj': return 11448; case 'et': return 11716;
        case 'fh': return 10608; case 'as': return 11155;
        case 'rf': return 11628; case 'xw': return 14280;
        case 'yf': return 12342; case 'qt': return 13108;
        case 'ad': return 9700; case 'lb': return 10584;
        case 'nk': return 11770; case 'hj': return 11024;
        case 'nw': return 13090; case 'qm': return 12317;
        case 'fs': return 11730; case 'gy': return 12463;
        case 'gd': return 10300; case 'zd': return 12200;
        case 'is': return 12075; case 'zf': return 12444;
        case 'kp': return 11984; case 'sn': return 12650;
        case 'jl': return 11448; case 'ec': return 9999;
        case 'hn': return 11440; case 'dz': return 12200;
        case 'fi': return 10710; case 'si': return 12075;
        case 'xq': return 13560; case 'mu': return 12753;
        case 'lz': return 13176; case 'qp': return 12656;
        case 'ug': return 12051; case 'gx': return 12360;
        case 'nr': return 12540; case 'nq': return 12430;
        case 'ej': return 10706; case 'kd': return 10700;
        case 'am': return 10573; case 'kq': return 12091;
        case 'nz': return 13420; case 'hv': return 12272;
        case 'hi': return 10920; case 'tu': return 13572;
        case 'md': return 10900; case 'cz': return 12078;
        case 'mp': return 12208; case 'nx': return 13200;
        case 'ar': return 11058; case 'bw': return 11662;
        case 'cv': return 11682; case 'ir': return 11970;
        case 'xo': return 13320; case 'xv': return 14160;
        case 'fu': return 11934; case 'ra': return 11058;
        case 'pw': return 13328; case 'jr': return 12084;
        case 'oq': return 12543; case 'je': return 10706;
        case 'yk': return 12947; case 'po': return 12432;
        case 'uj': return 12402; case 'lg': return 11124;
        case 'gc': return 10197; case 'ah': return 10088;
        case 'vw': return 14042; case 'mr': return 12426;
        case 'on': return 12210; case 'ey': return 12221;
        case 'zi': return 12810; case 'hw': return 12376;
        case 'iq': return 11865; case 'ax': return 11640;
        case 'hz': return 12688; case 'pm': return 12208;
        case 'up': return 13104; case 'mv': return 12862;
        case 've': return 11918; case 'vq': return 13334;
        case 'wn': return 13090; case 'ox': return 13320;
        case 'gr': return 11742; case 'bv': return 11564;
        case 'zq': return 13786; case 'qz': return 13786;
        case 'cx': return 11880; case 'wt': return 13804;
        case 'vt': return 13688; case 'yc': return 11979;
        case 'lr': return 12312; case 'ok': return 11877;
        case 'qb': return 11074; case 'vz': return 14396;
        case 'sf': return 11730; case 'ic': return 10395;
        case 'bh': return 10192; case 'ti': return 12180;
        case 'fo': return 11322; case 'ma': return 10573;
        case 'xn': return 13200; case 'qy': return 13673;
        case 'cu': return 11583; case 'da': return 9700;
        case 'so': return 12765; case 'ys': return 13915;
        case 'ea': return 9797; case 'qk': return 12091;
        case 'zy': return 14762; case 'ph': return 11648;
        case 'tj': return 12296; case 'vk': return 12626;
        case 'rt': return 13224; case 'mo': return 12099;
        case 'jo': return 11766; case 'zw': return 14518;
        case 'ky': return 12947; case 'xb': return 11760;
        case 'vb': return 11564; case 'uc': return 11583;
        case 'bx': return 11760; case 'mq': return 12317;
        case 'sx': return 13800; case 'cf': return 10098;
        case 'bg': return 10094; case 'xz': return 14640;
        case 'nn': return 12100; case 'kg': return 11021;
        case 'pg': return 11536; case 'vg': return 12154;
        case 'wm': return 12971; case 'pq': return 12656;
        case 'qo': return 12543; case 'el': return 10908;
        case 'ro': return 12654; case 'tp': return 12992;
        case 'ii': return 11025; case 'ts': return 13340;
        case 'ke': return 10807; case 'vj': return 12508;
        case 'kw': return 12733; case 'ut': return 13572;
        case 'xh': return 12480; case 'aw': return 11543;
        case 'id': return 10500; case 'hy': return 12584;
        case 'um': return 12753; case 'my': return 13189;
        case 'tz': return 14152; case 'rw': return 13566;
        case 'yu': return 14157; case 'pu': return 13104;
        case 'hp': return 11648; case 'su': return 13455;
        case 'to': return 12876; case 'qf': return 11526;
        case 'ov': return 13098; case 'js': return 12190;
        case 'mi': return 11445; case 'py': return 13552;
        case 'xr': return 13680; case 'tw': return 13804;
        case 'sy': return 13915; case 'yd': return 12100;
        case 're': return 11514; case 'bt': return 11368;
        case 'qu': return 13221; case 'nj': return 11660;
        case 'fl': return 11016; case 'bq': return 11074;
        case 'wq': return 13447; case 'mw': return 12971;
        case 'mg': return 11227; case 'en': return 11110;
        case 'he': return 10504; case 'bo': return 10878;
        case 'yb': return 11858; case 'mm': return 11881;
        case 'lx': return 12960; case 'qv': return 13334;
        case 'ix': return 12600; case 'ua': return 11349;
        case 'hq': return 11752; case 'gq': return 11639;
        case 'dl': return 10800; case 'dk': return 10700;
        case 'di': return 10500; case 'qa': return 10961;
        case 'vh': return 12272; case 'wg': return 12257;
        case 'lt': return 12528; case 'gf': return 10506;
        case 'gn': return 11330; case 'yw': return 14399;
        case 'oa': return 10767; case 'vp': return 13216;
        case 'bj': return 10388; case 'vr': return 13452;
        case 'dp': return 11200; case 'qg': return 11639;
        case 'ab': return 9506; case 'ef': return 10302;
        case 'we': return 12019; case 'xp': return 13440;
        case 'co': return 10989; case 'ot': return 12876;
        case 'yh': return 12584; case 'qn': return 12430;
        case 'yg': return 12463; case 'cr': return 11286;
        case 'vi': return 12390; case 'ws': return 13685;
        case 'sq': return 12995; case 'ez': return 12322;
        case 'zx': return 14640; case 'cn': return 10890;
        case 'ij': return 11130; case 'rr': return 12996;
        case 'pp': return 12544; case 'vl': return 12744;
        case 'rz': return 13908; case 'ap': return 10864;
        case 'rj': return 12084; case 'ux': return 14040;
        case 'pj': return 11872; case 'nd': return 11000;
        case 'cc': return 9801; case 'os': return 12765;
        case 'tn': return 12760; case 'iw': return 12495;
        case 'sv': return 13570; case 'mt': return 12644;
        case 'ik': return 11235; case 'xs': return 13800;
        case 'mx': return 13080; case 'pe': return 11312;
        case 'th': return 12064; case 'xt': return 13920;
        case 'uo': return 12987; case 'fw': return 12138;
        case 'kz': return 13054; case 'pd': return 11200;
        case 'pk': return 11984; case 'nl': return 11880;
        case 'nv': return 12980; case 'ay': return 11737;
        case 'ww': return 14161; case 'ly': return 13068;
        case 'xx': return 14400; case 'dt': return 11600;
        case 'xf': return 12240; case 'sb': return 11270;
        case 'uk': return 12519; case 'ag': return 9991;
        case 'hd': return 10400; case 'oc': return 10989;
        case 'it': return 12180; case 'rg': return 11742;
        case 'bf': return 9996; case 'xc': return 11880;
        case 'im': return 11445; case 'ou': return 12987;
        case 'wk': return 12733; case 'gt': return 11948;
        case 'mc': return 10791; case 'hf': return 10608;
        case 'oz': return 13542; case 'ul': return 12636;
        case 'fv': return 12036; case 'ns': return 12650;
        case 'pr': return 12768; case 'rs': return 13110;
        case 'fd': return 10200; case 'sc': return 11385;
        case 'sj': return 12190; case 'yn': return 13310;
        case 'gu': return 12051; case 'tk': return 12412;
        case 'vx': return 14160; case 'ty': return 14036;
        case 'bi': return 10290; case 'xm': return 13080;
        case 'ko': return 11877; case 'np': return 12320;
        case 'nb': return 10780; case 'gi': return 10815;
        case 'ui': return 12285; case 'oi': return 11655;
        case 'do': return 11100; case 'cs': return 11385;
        case 'za': return 11834; case 'oh': return 11544;
        case 'dg': return 10300; case 'zb': return 11956;
        case 'om': return 12099; case 'ed': return 10100;
        case 'gg': return 10609; case 'tq': return 13108;
        case 'xl': return 12960; case 'in': return 11550;
        case 'ae': return 9797; case 'ne': return 11110;
        case 'du': return 11700; case 'uu': return 13689;
        case 'bu': return 11466; case 'ya': return 11737;
        case 'kn': return 11770; case 'pt': return 12992;
        case 'pc': return 11088; case 'la': return 10476;
        case 'mf': return 11118; case 'op': return 12432;
        case 'pi': return 11760; case 'rl': return 12312;
        case 'cb': return 9702; case 'ie': return 10605;
        case 'rm': return 12426; case 'iv': return 12390;
        case 'ba': return 9506; case 'oj': return 11766;
        case 'oo': return 12321; case 'fy': return 12342;
        case 'td': return 11600; case 'fn': return 11220;
        case 'zo': return 13542; case 'sr': return 13110;
        case 'jb': return 10388; case 'jh': return 11024;
        case 'ev': return 11918; case 'hr': return 11856;
        case 'dq': return 11300; case 'gp': return 11536;
        case 'fg': return 10506; case 'uy': return 14157;
        case 'rq': return 12882; case 'hg': return 10712;
        case 'br': return 11172; case 'nc': return 10890;
        case 'xk': return 12840; case 'rv': return 13452;
        case 'ng': return 11330; case 'mj': return 11554;
        case 'gz': return 12566; case 'us': return 13455;
        case 'ue': return 11817; case 'qx': return 13560;
        case 'jw': return 12614; case 'vn': return 12980;
        case 'zh': return 12688; case 'wc': return 11781;
        case 'bn': return 10780; case 'fk': return 10914;
        case 'gl': return 11124; case 'aa': return 9409;
        case 'jz': return 12932; case 'uw': return 13923;
        case 'lq': return 12204; case 'wd': return 11900;
        case 'va': return 11446; case 'fq': return 11526;
        case 'dm': return 10900; case 'ht': return 12064;
        case 'bc': return 9702; case 'tv': return 13688;
        case 'xg': return 12360; case 'tm': return 12644;
        case 'ds': return 11500; case 'zn': return 13420;
        case 'wy': return 14399; case 'wh': return 12376;
        case 'sp': return 12880; case 'fe': return 10302;
        case 'wx': return 14280; case 'nm': return 11990;
        case 'ai': return 10185; case 'dn': return 11000;
        case 'ac': return 9603; case 'zl': return 13176;
        case 'ud': return 11700; case 'ss': return 13225;
        case 'ci': return 10395; case 'bb': return 9604;
        case 'ja': return 10282; case 'ga': return 9991;
        case 'io': return 11655; case 'lo': return 11988;
        case 'lm': return 11772; case 'lu': return 12636;
        case 'hk': return 11128; case 'oy': return 13431;
        case 'yj': return 12826; case 'wj': return 12614;
        case 'az': return 11834; case 'mk': return 11663;
        case 'ub': return 11466; case 'qi': return 11865;
        case 'ca': return 9603; case 'jg': return 10918;
        case 'go': return 11433; case 'qw': return 13447;
        case 'de': return 10100; case 'aq': return 10961;
        case 'bz': return 11956; case 'ff': return 10404;
        case 'rx': return 13680; case 'tf': return 11832;
        case 'ia': return 10185; case 'kc': return 10593;
        case 'qr': return 12882; case 'wi': return 12495;
        case 'ch': return 10296; case 'hl': return 11232;
        case 'wv': return 14042; case 'rk': return 12198;
        case 'xu': return 14040; case 'of': return 11322;
        case 'oe': return 11211; case 'df': return 10200;
        case 'ms': return 12535; case 'fc': return 10098;
        case 'uf': return 11934; case 'if': return 10710;
        case 'll': return 11664; case 'qh': return 11752;
        case 'wb': return 11662; case 'qe': return 11413;
        case 'te': return 11716; case 'bs': return 11270;
        case 'vs': return 13570; case 'jp': return 11872;
        case 'wp': return 13328; case 'dy': return 12100;
        case 'eg': return 10403; case 'ft': return 11832;
        case 'ck': return 10593; case 'jj': return 11236;
        case 'dh': return 10400; case 'ka': return 10379;
        default: return 0;
    }
}

fn bench_switch(max_itr = 15) {
    param_seq = [
        ['sd', 11500], ['mp', 12208], ['xg', 12360], ['ok', 11877], ['ut', 13572], ['dz', 12200], ['cn', 10890], ['oa', 10767], ['yl', 13068],
        ['sq', 12995], ['gk', 11021], ['qe', 11413], ['cd', 9900], ['mq', 12317], ['up', 13104], ['hk', 11128], ['rs', 13110], ['nn', 12100],
        ['hg', 10712], ['ke', 10807], ['cl', 10692], ['qc', 11187], ['gi', 10815], ['ui', 12285], ['hd', 10400], ['ti', 12180], ['rt', 13224],
        ['id', 10500], ['ag', 9991], ['th', 12064], ['ci', 10395], ['wi', 12495], ['eu', 11817], ['se', 11615], ['nk', 11770], ['oq', 12543],
        ['yf', 12342], ['ll', 11664], ['uf', 11934], ['ii', 11025], ['qw', 13447], ['qh', 11752], ['hw', 12376], ['rf', 11628], ['ip', 11760],
        ['eo', 11211], ['kx', 12840], ['ks', 12305], ['sh', 11960], ['qs', 12995], ['pc', 11088], ['lw', 12852], ['gf', 10506], ['le', 10908],
        ['at', 11252], ['jk', 11342], ['kd', 10700], ['uv', 13806], ['cj', 10494], ['jj', 11236], ['il', 11340], ['xa', 11640], ['gw', 12257],
        ['ff', 10404], ['ry', 13794], ['va', 11446], ['xk', 12840], ['qt', 13108], ['aj', 10282], ['wz', 14518], ['qk', 12091], ['nh', 11440],
        ['si', 12075], ['ga', 9991], ['ir', 11970], ['qp', 12656], ['fb', 9996], ['kf', 10914], ['cg', 10197], ['fa', 9894], ['zd', 12200],
        ['zg', 12566], ['tj', 12296], ['qz', 13786], ['ov', 13098], ['ba', 9506], ['ix', 12600], ['ee', 10201], ['tp', 12992], ['yz', 14762],
        ['yw', 14399], ['ek', 10807], ['kg', 11021], ['ec', 9999], ['sn', 12650], ['ma', 10573], ['ts', 13340], ['ni', 11550], ['fk', 10914],
        ['pb', 10976], ['vx', 14160], ['ez', 12322], ['hz', 12688], ['kz', 13054], ['uu', 13689], ['fx', 12240], ['zq', 13786], ['sk', 12305],
        ['wc', 11781], ['ht', 12064], ['xx', 14400], ['to', 12876], ['py', 13552], ['hi', 10920], ['sl', 12420], ['tf', 11832], ['od', 11100],
        ['vr', 13452], ['ue', 11817], ['hq', 11752], ['oz', 13542], ['xh', 12480], ['pf', 11424], ['fn', 11220], ['pe', 11312], ['tm', 12644],
        ['wo', 13209], ['wr', 13566], ['ij', 11130], ['ln', 11880], ['el', 10908], ['xd', 12000], ['gt', 11948], ['oj', 11766], ['gl', 11124],
        ['gb', 10094], ['ye', 12221], ['ig', 10815], ['rp', 12768], ['oi', 11655], ['pj', 11872], ['iy', 12705], ['zz', 14884], ['mk', 11663],
        ['gh', 10712], ['by', 11858], ['rl', 12312], ['re', 11514], ['aw', 11543], ['zn', 13420], ['sr', 13110], ['gd', 10300], ['ef', 10302],
        ['fp', 11424], ['za', 11834], ['hj', 11024], ['if', 10710], ['ob', 10878], ['gs', 11845], ['xi', 12600], ['st', 13340], ['lo', 11988],
        ['qm', 12317], ['gy', 12463], ['vk', 12626], ['bb', 9604], ['vg', 12154], ['yh', 12584], ['vo', 13098], ['iw', 12495], ['ep', 11312],
        ['ik', 11235], ['vu', 13806], ['cz', 12078], ['wj', 12614], ['sa', 11155], ['ko', 11877], ['hs', 11960], ['ed', 10100], ['eg', 10403],
        ['ve', 11918], ['ou', 12987], ['me', 11009], ['mw', 12971], ['ch', 10296], ['ds', 11500], ['wa', 11543], ['ai', 10185], ['lf', 11016],
        ['uc', 11583], ['ml', 11772], ['gj', 10918], ['cf', 10098], ['po', 12432], ['zv', 14396], ['ug', 12051], ['dp', 11200], ['io', 11655],
        ['vz', 14396], ['km', 11663], ['un', 12870], ['ow', 13209], ['hh', 10816], ['wn', 13090], ['ca', 9603], ['jh', 11024], ['fq', 11526],
        ['fz', 12444], ['iq', 11865], ['zh', 12688], ['ox', 13320], ['lr', 12312], ['fs', 11730], ['pm', 12208], ['sx', 13800], ['tu', 13572],
        ['dx', 12000], ['yq', 13673], ['lt', 12528], ['pi', 11760], ['ly', 13068], ['tw', 13804], ['cr', 11286], ['ea', 9797], ['uj', 12402],
        ['nm', 11990], ['ws', 13685], ['uq', 13221], ['uo', 12987], ['zx', 14640], ['xs', 13800], ['mg', 11227], ['fw', 12138], ['sc', 11385],
        ['rw', 13566], ['zk', 13054], ['vh', 12272], ['tx', 13920], ['hv', 12272], ['rd', 11400], ['fm', 11118], ['ad', 9700], ['um', 12753],
        ['ra', 11058], ['fc', 10098], ['rr', 12996], ['xy', 14520], ['wu', 13923], ['vd', 11800], ['jy', 12826], ['lz', 13176], ['xc', 11880],
        ['kr', 12198], ['xf', 12240], ['zj', 12932], ['sj', 12190], ['kj', 11342], ['qg', 11639], ['mv', 12862], ['wl', 12852], ['su', 13455],
        ['ge', 10403], ['zc', 12078], ['zw', 14518], ['fh', 10608], ['bn', 10780], ['jg', 10918], ['di', 10500], ['rm', 12426], ['nf', 11220],
        ['px', 13440], ['uz', 14274], ['qd', 11300], ['hb', 10192], ['tv', 13688], ['co', 10989], ['gc', 10197], ['bv', 11564], ['mx', 13080],
        ['bf', 9996], ['iv', 12390], ['qr', 12882], ['aa', 9409], ['hl', 11232], ['ia', 10185], ['hy', 12584], ['ul', 12636], ['fr', 11628],
        ['bl', 10584], ['lb', 10584], ['wx', 14280], ['bk', 10486], ['yr', 13794], ['dy', 12100], ['dw', 11900], ['kw', 12733], ['ae', 9797],
        ['ap', 10864], ['qy', 13673], ['ar', 11058], ['us', 13455], ['uk', 12519], ['dh', 10400], ['br', 11172], ['og', 11433], ['ay', 11737],
        ['do', 11100], ['ne', 11110], ['ps', 12880], ['xo', 13320], ['bt', 11368], ['jv', 12508], ['ct', 11484], ['jt', 12296], ['he', 10504],
        ['nt', 12760], ['hm', 11336], ['eh', 10504], ['ya', 11737], ['nq', 12430], ['vy', 14278], ['jw', 12614], ['nc', 10890], ['fv', 12036],
        ['ro', 12654], ['pz', 13664], ['tb', 11368], ['xz', 14640], ['jp', 11872], ['ur', 13338], ['ua', 11349], ['oy', 13431], ['lv', 12744],
        ['fl', 11016], ['mr', 12426], ['wh', 12376], ['xm', 13080], ['sv', 13570], ['vs', 13570], ['hr', 11856], ['cp', 11088], ['kv', 12626],
        ['jm', 11554], ['cm', 10791], ['iu', 12285], ['fg', 10506], ['ot', 12876], ['gp', 11536], ['gg', 10609], ['qb', 11074], ['dq', 11300],
        ['ss', 13225], ['pr', 12768], ['qf', 11526], ['vm', 12862], ['zr', 13908], ['jo', 11766], ['da', 9700], ['bx', 11760], ['nu', 12870],
        ['nv', 12980], ['cb', 9702], ['du', 11700], ['lh', 11232], ['op', 12432], ['fi', 10710], ['wy', 14399], ['zi', 12810], ['hp', 11648],
        ['hf', 10608], ['hu', 12168], ['ku', 12519], ['na', 10670], ['ac', 9603], ['de', 10100], ['dm', 10900], ['pp', 12544], ['ta', 11252],
        ['ck', 10593], ['xl', 12960], ['em', 11009], ['vf', 12036], ['kk', 11449], ['ji', 11130], ['uw', 13923], ['ho', 11544], ['on', 12210],
        ['kt', 12412], ['jl', 11448], ['yx', 14520], ['dg', 10300], ['ey', 12221], ['wq', 13447], ['cy', 11979], ['cc', 9801], ['vw', 14042],
        ['an', 10670], ['fy', 12342], ['pl', 12096], ['bz', 11956], ['yi', 12705], ['rj', 12084], ['dn', 11000], ['xt', 13920], ['vq', 13334],
        ['es', 11615], ['ha', 10088], ['tq', 13108], ['it', 12180], ['ei', 10605], ['jd', 10600], ['ic', 10395], ['ao', 10767], ['md', 10900],
        ['ju', 12402], ['vb', 11564], ['wg', 12257], ['wt', 13804], ['qq', 12769], ['yb', 11858], ['az', 11834], ['sy', 13915], ['cx', 11880],
        ['cu', 11583], ['rb', 11172], ['wd', 11900], ['jb', 10388], ['qn', 12430], ['zb', 11956], ['zl', 13176], ['aq', 10961], ['nx', 13200],
        ['te', 11716], ['bs', 11270], ['td', 11600], ['ns', 12650], ['wv', 14042], ['bq', 11074], ['oc', 10989], ['ww', 14161], ['ka', 10379],
        ['zy', 14762], ['qj', 11978], ['sm', 12535], ['ze', 12322], ['yv', 14278], ['ce', 9999], ['oh', 11544], ['rk', 12198], ['os', 12765],
        ['vi', 12390], ['er', 11514], ['tl', 12528], ['dc', 9900], ['xj', 12720], ['jq', 11978], ['tz', 14152], ['lj', 11448], ['dd', 10000],
        ['vl', 12744], ['sb', 11270], ['xb', 11760], ['rv', 13452], ['rh', 11856], ['xr', 13680], ['np', 12320], ['dk', 10700], ['ql', 12204],
        ['mn', 11990], ['ah', 10088], ['sf', 11730], ['hn', 11440], ['fj', 10812], ['hx', 12480], ['oo', 12321], ['bg', 10094], ['ej', 10706],
        ['vv', 13924], ['eb', 9898], ['mu', 12753], ['tn', 12760], ['ri', 11970], ['kq', 12091], ['zo', 13542], ['ru', 13338], ['is', 12075],
        ['yo', 13431], ['qi', 11865], ['fe', 10302], ['gz', 12566], ['dr', 11400], ['mt', 12644], ['pg', 11536], ['qa', 10961], ['ms', 12535],
        ['ld', 10800], ['ym', 13189], ['al', 10476], ['en', 11110], ['mb', 10682], ['ex', 12120], ['bh', 10192], ['yp', 13552], ['lp', 12096],
        ['oe', 11211], ['bp', 10976], ['nz', 13420], ['xq', 13560], ['xp', 13440], ['ft', 11832], ['jf', 10812], ['ab', 9506], ['we', 12019],
        ['hc', 10296], ['kl', 11556], ['wk', 12733], ['kb', 10486], ['ol', 11988], ['tr', 13224], ['fd', 10200], ['wb', 11662], ['gx', 12360],
        ['ty', 14036], ['sw', 13685], ['bm', 10682], ['sp', 12880], ['gq', 11639], ['ib', 10290], ['om', 12099], ['gm', 11227], ['mi', 11445],
        ['pq', 12656], ['mf', 11118], ['eq', 11413], ['vt', 13688], ['cq', 11187], ['pk', 11984], ['pu', 13104], ['ax', 11640], ['nw', 13090],
        ['lg', 11124], ['qo', 12543], ['ng', 11330], ['kn', 11770], ['or', 12654], ['mo', 12099], ['ud', 11700], ['nl', 11880], ['yg', 12463],
        ['jc', 10494], ['gn', 11330], ['yt', 14036], ['yc', 11979], ['dt', 11600], ['pd', 11200], ['cv', 11682], ['am', 10573], ['vc', 11682],
        ['bu', 11466], ['bd', 9800], ['yd', 12100], ['ub', 11466], ['rq', 12882], ['ev', 11918], ['tc', 11484], ['ky', 12947], ['xv', 14160],
        ['qu', 13221], ['iz', 12810], ['yj', 12826], ['my', 13189], ['et', 11716], ['ls', 12420], ['pt', 12992], ['mz', 13298], ['as', 11155],
        ['vj', 12508], ['no', 12210], ['tg', 11948], ['rc', 11286], ['af', 9894], ['vp', 13216], ['pa', 10864], ['xw', 14280], ['qv', 13334],
        ['lx', 12960], ['wf', 12138], ['uy', 14157], ['gu', 12051], ['ys', 13915], ['pv', 13216], ['bj', 10388], ['sg', 11845], ['ie', 10605],
        ['sz', 14030], ['zu', 14274], ['kc', 10593], ['ja', 10282], ['pw', 13328], ['gv', 12154], ['js', 12190], ['be', 9898], ['yy', 14641],
        ['jr', 12084], ['db', 9800], ['wp', 13328], ['rn', 12540], ['lm', 11772], ['bo', 10878], ['dv', 11800], ['li', 11340], ['tt', 13456],
        ['xu', 14040], ['nb', 10780], ['zp', 13664], ['tk', 12412], ['df', 10200], ['ph', 11648], ['cw', 11781], ['dj', 10600], ['nj', 11660],
        ['qx', 13560], ['ih', 10920], ['jz', 12932], ['mc', 10791], ['kp', 11984], ['gr', 11742], ['of', 11322], ['nd', 11000], ['lu', 12636],
        ['ny', 13310], ['au', 11349], ['fo', 11322], ['rx', 13680], ['av', 11446], ['mj', 11554], ['yu', 14157], ['so', 12765], ['ew', 12019],
        ['zf', 12444], ['bi', 10290], ['in', 11550], ['im', 11445], ['go', 11433], ['zs', 14030], ['vn', 12980], ['rg', 11742], ['jx', 12720],
        ['fu', 11934], ['xn', 13200], ['ux', 14040], ['zt', 14152], ['uh', 12168], ['mh', 11336], ['la', 10476], ['yn', 13310], ['jn', 11660],
        ['ki', 11235], ['dl', 10800], ['zm', 13298], ['rz', 13908], ['yk', 12947], ['pn', 12320], ['nr', 12540], ['lk', 11556], ['mm', 11881],
        ['lq', 12204], ['wm', 12971], ['kh', 11128], ['bc', 9702], ['je', 10706], ['cs', 11385], ['lc', 10692], ['bw', 11662], ['xe', 12120],
        ['ak', 10379]
    ];

    for itr = 1; itr <= max_itr; itr++ {
        println("bench_switch: iteration " + itr + " of " + max_itr + "...");
        m_parts = [];
        for i = 0, l = length(param_seq); i < l; i++ {
            v = param_seq[i][0];
            m_start = ns_time();
            result = test_switch(v);
            m_end = ns_time();
            if result != param_seq[i][1] {
                println("ERROR(" + i + "): " + stringify_list(param_seq[i], false) + " => " + result);
                return;
            }
            array_push(m_parts, (m_end - m_start));
        }
        print_bench_data({
            'name':   "bench_switch",
            'i':      itr,
            'c':      max_itr,
            'scores': m_parts
        });
    }
}

fn test_loop() {
    for i = 0; i < 1_000; i++ {
        for j = 0; j < 1_000; j++ {
            // no-op
        }
    }
}

fn bench_loop(itrc = 5) {
    for itr = 1; itr <= itrc; itr++ {
        m_start = ns_time();
        test_loop();
        m_end = ns_time();

        print_bench_data({
            'name': 'Loop bench',
            'score': m_end - m_start,
            'i':    itr,
            'c':    itrc
        });
    }
}

fn print_bench_data(bench_data) {
    name = bench_data.name ?? "<unknown>";
    i    = bench_data.i ?? "?";
    c    = bench_data.i ?? "?";
    println("=== " + name + " (" + i + "/" + c + ") ===");

    scores = bench_data.time ??
                bench_data.times ??
                bench_data.score ??
                bench_data.scores ??
                [];
    if array_index_of(['map', 'array'], typeof(scores)) < 0 {
        scores = [scores];
    } else if length(scores) == 0 {
        println("<there is no scores>");
        return;
    }
    score_b = array_min(scores);                                  /* best */
    score_w = array_max(scores);                                  /* worst */
    units_h = 1E9 / (score_b == 0 ? 1 : score_b);                 /* highest */
    units_l = 1E9 / (score_w == 0 ? 1 : score_w);                 /* lowest */
    units_a = (units_l + units_h) / 2;                            /* average */
    units_r = ((units_a - units_l) + (units_h - units_a)) / 2;    /* error rate */
    println("score: " + round(units_a, 3) + "±" + round(units_r, 3) + " op/sec");
}

fn complex(r, i) = {
    'r': r,
    'i': i
};

fn complex_add(c1, c2) = complex(
    (c1.r + c2.r),
    (c1.i + c2.i)
);

fn complex_mul(c1, c2) = complex(
    (c1.r * c2.r - c1.i * c2.i),
    (c1.r * c2.i + c1.i * c2.r)
);

fn complex_div(c1, c2) = complex(
    (c1.r * c2.r + c1.i * c2.i) / (c2.r * c2.r + c2.i * c2.i),
    (c1.i * c2.r - c1.r * c2.i) / (c2.r * c2.r + c2.i * c2.i)
);

fn stringify_complex(z) = z.r + " + " + z.i + "i";

fn complex_equals(c1, c2) = (c1.r == c2.r) && (c1.i == c2.i);

fn complex_test(test_id) {
    switch test_id {
        case 1: {
            a = complex(100.0, 10.0);
            b = complex(0.0, 10.0);
            c = complex_div(a, b);
            println(stringify_complex(c));
            d = complex_mul(c, b);
            println(stringify_complex(d)); // 100 + 10i
        }
        case 2: {
            // r₁ / r₂ = r₁ * (1 / r₂)
            // z₁ / z₂ = z₁ * (1 / z₂)
            a  = complex(44.0, 99.0);
            b  = complex(4.0, 10.0);
            c  = complex_div(
                complex(1.0, 0.0),
                b
            );
            println(stringify_complex(c));
            d1 = complex_div(a, b);
            d2 = complex_mul(a, c);
            // d1 should be equal to d2
            println(stringify_complex(d1));
            println(stringify_complex(d2));
        }
    }
}

fn bench_stub() {
    max = 1e9;
    while true {
        a = ns_time();
        stub();
        b = ns_time();
        m = (b - a);
        if m < max {
            print_bench_data({
                'name': 'Stub bench',
                'score': m
            });
            max = m;
        }
    }
}

fn stub(i = 10) = i <= 0 ? null : stub(i - 1);

bench_switch();