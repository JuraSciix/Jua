fn range(from, to, step = 1) {
    range = [];
    for i = from; i <= to; i += step {
        array_push(range, i);
    }
    return range;
}

fn array_push(arr, elem) {
    arr[length(arr)] = elem;
}

fn array_pop(arr) {
    tmp = arr[key = length(arr) - 1];
    arr[key] = null;
    return tmp;
}

fn array_avg(arr) {
    cleaned_arr = array_unique(arr);
    if (len = length(cleaned_arr)) < 1
        return cleaned_arr[0] ?? 0.0;
    return array_sum(cleaned_arr) / len;
}

fn array_max(arr) {
    m = arr[0];
    for i = 1, l = length(arr); i < l; i++ {
        if (e = arr[i]) > m {
            m = e;
        }
    }
    return m;
}

fn array_min(arr) {
    m = arr[0];
    for i = 1, l = length(arr); i < l; i++ {
        if (e = arr[i]) < m {
            m = e;
        }
    }
    return m;
}

fn array_index_of(arr, elem, start = 0) {
    for l = length(arr), i = start; i < l; i++ {
        if arr[i] == elem {
            return i;
        }
    }
    return -1;
}

fn array_last_index_of(arr, elem, start = 0) {
    for l = length(arr), i = l - start - 1; i >= 0; i-- {
        if arr[i] == elem {
            return i;
        }
    }
    return -1;
}

fn array_unique(arr) {
    if length(arr) <= 1
        return arr;
    result = [];
    for i = 0, l = length(arr); i < l; i++ {
        if array_index_of(result, arr[i]) == -1 {
            array_push(result, arr[i]);
        }
    }
    return result;
}

fn array_sum(arr) {
    sum = 0;
    for i = 0, l = length(arr); i < l; i++ {
        sum += arr[i];
    }
    return sum;
}

fn join(pieces, separator) {
    s = "";
    if (len = length(pieces)) > 0 {
        s += pieces[0];

        for i = 1; i < len; i++ {
            s = s + separator + pieces[i];
        }
    }
    return s;
}

fn stringify_list(l) {
    s = "";
    for i = 0; i < length(l); i++ {
        if s { // check if s not empty
            s += ", ";
        }
        if array_index_of(['map', 'array'], typeof(l[i])) >= 0
            s += "<map>";
        else if l[i] == l
            s += "<self>";
        else
            s += stringify_list(l[i]);
    }
    return "[" + s + "]";
}